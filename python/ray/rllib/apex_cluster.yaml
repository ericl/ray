cluster_name: apex
min_workers: 8
max_workers: 8
target_utilization_fraction: 0.8
idle_timeout_minutes: 5
provider:
    type: aws
    region: us-east-1
    availability_zone: us-east-1a
auth:
    ssh_user: ubuntu
head_node:
    InstanceType: p3.8xlarge
    ImageId: ami-e07e779a
worker_nodes:
    InstanceType: m4.4xlarge
    ImageId: ami-e07e779a
    InstanceMarketOptions:
        MarketType: spot
file_mounts: {
    "/tmp/apex_sha": "/home/eric/Desktop/ray-private/.git/refs/heads/apex",
}
setup_commands:
    - pkill -9 python || true
    - test -e ray || git clone https://github.com/ericl/ray.git
    - cd ray && git stash; git fetch && git checkout `cat /tmp/apex_sha`
    - while sudo fuser /var/lib/apt/lists/lock >/dev/null 2>&1; do sleep 1; done; sudo apt-get update
    - while sudo fuser /var/lib/dpkg/lock >/dev/null 2>&1; do sleep 1; done
    - source activate tensorflow_p27 && sudo apt-get install -y cmake pkg-config build-essential autoconf curl libtool unzip python # we install python here because python2 is required to build the webui
    - source activate tensorflow_p27 && conda uninstall -y libgcc gcc && pip install cython && pip install gym[atari] && cd ray/python && pip install -e .
head_setup_commands:
    - pip install boto3==1.4.8  # 1.4.8 adds InstanceMarketOptions
worker_setup_commands: []
head_start_ray_commands:
    - source activate tensorflow_p27 && ray stop
    - source activate tensorflow_p27 && ray start --head --redis-port=6379 --autoscaling-config=~/ray_bootstrap_config.yaml
worker_start_ray_commands:
    - source activate tensorflow_p27 && ray stop
    - source activate tensorflow_p27 && ray start --redis-address=$RAY_HEAD_IP:6379
